---
output:
  md_document:
    variant: markdown_github
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
library(dplyr)
```

# vapour

The goal of vapour is to learn C++ enough to help create a **GDAL API** package for R
so that R package developers have a common foundation to extend. A common foundation is
required so that general tools can be developed from a general resource, and so specific goals
and choices made for other projects can be maintained separately. A parallel goal is to be freed from the powerful but sometimes limiting high-level data models of GDAL itself, specifically these are *simple features* and *affine-based regular rasters composed of 2D slices*. GDAL will possibly remove these limitations over time but still there will always be value in having modularity in an ecosystem of tools. 

Currently all it does is read the geometry as text and / or read the attribute table from a vector source (only integer, double and character types are supported.) This is inspired by and draws heavily on [the sf package, simple features for R](https://github.com/r-spatial/sf). 

Big thanks to Edzer Pebesma and Roger Bivand for prior art that I crib and copy from. 




## Examples

There's a low level function `vapour` that returns the attributes as  list of vectors. 

```{r}
pfile <- system.file("extdata", "point.shp", package = "vapour")
library(vapour)
vapour(pfile)
```

A higher level function `read_gdal_attribute` wraps that function to return a data frame. 

```{r}
sfile <- system.file("shape/nc.shp", package="sf")

read_gdal_table(sfile)
```

There are many useful higher level operations that can be used with this. The simplest is the ability to use GDAL as a database-like connection to attribute tables. 

A low-level function will return a character vector of JSON, GML, KML or WKT. 

```{r}
to_format(pfile)[5:6]  ## format = "json"

sfile <- system.file("shape/nc.shp", package="sf")

to_format(sfile, format = "gml")[99:100]

to_format(sfile, format = "kml")[1:2]
```


We can combine these together to get a custom data set. 

```{r}
library(dplyr)
dat <- read_gdal_table(sfile) %>% dplyr::mutate(kml = to_format(sfile, format = "kml"))
glimpse(dat)
```
## Set up

I've kept a record of a minimal GDAL wrapper package here: 

https://github.com/mdsumner/gdalmin

This must be run when your function definitions change: 

```R
tools::package_native_routine_registration_skeleton("../vapour", "src/init.c",character_only = FALSE)
```



# Code of conduct

Please note that this project is released with a [Contributor Code of Conduct](CONDUCT.md). By participating in this project you agree to abide by its terms.
